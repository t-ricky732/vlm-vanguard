WandB initialized.
--- Environment Setup Complete ---

--- Defining Data Loading Function (with Debugging) ---

--- Loading and Splitting Data ---
Found 7 JSON files in chartllama_data.

Processing file: candlestick_chart_100examples_simplified_qa.json (165 entries)
  Entry 0:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_86.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_86.png'
    Path exists (is_file)? True
  Entry 1:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_83.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_83.png'
    Path exists (is_file)? True
  Entry 2:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_0.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_0.png'
    Path exists (is_file)? True
  Entry 3:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_22.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_22.png'
    Path exists (is_file)? True
  Entry 4:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_68.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_68.png'
    Path exists (is_file)? True
  Entry 5:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_1.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_1.png'
    Path exists (is_file)? True
  Entry 6:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_54.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_54.png'
    Path exists (is_file)? True
  Entry 7:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_87.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_87.png'
    Path exists (is_file)? True
  Entry 8:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_12.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_12.png'
    Path exists (is_file)? True
  Entry 9:
    img_rel_path from JSON: 'ours/candlestick_chart/png/candlestick_chart_100examples_21.png'
    Constructed full path: 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_21.png'
    Path exists (is_file)? True

Processing file: funnel_chart_100examples_simplified_qa.json (153 entries)
  Entry 0:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_6.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_6.png'
    Path exists (is_file)? True
  Entry 1:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_29.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_29.png'
    Path exists (is_file)? True
  Entry 2:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_6.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_6.png'
    Path exists (is_file)? True
  Entry 3:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_39.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_39.png'
    Path exists (is_file)? True
  Entry 4:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_49.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_49.png'
    Path exists (is_file)? True
  Entry 5:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_17.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_17.png'
    Path exists (is_file)? True
  Entry 6:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_41.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_41.png'
    Path exists (is_file)? True
  Entry 7:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_2.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_2.png'
    Path exists (is_file)? True
  Entry 8:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_47.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_47.png'
    Path exists (is_file)? True
  Entry 9:
    img_rel_path from JSON: 'ours/funnel_chart/png/funnel_chart_100examples_67.png'
    Constructed full path: 'chartllama_data/ours/funnel_chart/png/funnel_chart_100examples_67.png'
    Path exists (is_file)? True

Processing file: gantt_chart_100examples_simplified_qa.json (167 entries)
  Entry 0:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_38.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_38.png'
    Path exists (is_file)? True
  Entry 1:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_65.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_65.png'
    Path exists (is_file)? True
  Entry 2:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_6.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_6.png'
    Path exists (is_file)? True
  Entry 3:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_0.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_0.png'
    Path exists (is_file)? True
  Entry 4:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_60.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_60.png'
    Path exists (is_file)? True
  Entry 5:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_36.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_36.png'
    Path exists (is_file)? True
  Entry 6:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_98.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_98.png'
    Path exists (is_file)? True
  Entry 7:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_13.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_13.png'
    Path exists (is_file)? True
  Entry 8:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_56.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_56.png'
    Path exists (is_file)? True
  Entry 9:
    img_rel_path from JSON: 'ours/gantt_chart/png/gantt_chart_100examples_60.png'
    Constructed full path: 'chartllama_data/ours/gantt_chart/png/gantt_chart_100examples_60.png'
    Path exists (is_file)? True

Processing file: polar_chart_100examples_simplified_qa.json (142 entries)
  Entry 0:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_119.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_119.png'
    Path exists (is_file)? True
  Entry 1:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_76.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_76.png'
    Path exists (is_file)? True
  Entry 2:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_121.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_121.png'
    Path exists (is_file)? True
  Entry 3:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_90.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_90.png'
    Path exists (is_file)? True
  Entry 4:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_67.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_67.png'
    Path exists (is_file)? True
  Entry 5:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_100.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_100.png'
    Path exists (is_file)? True
  Entry 6:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_160.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_160.png'
    Path exists (is_file)? True
  Entry 7:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_10.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_10.png'
    Path exists (is_file)? True
  Entry 8:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_149.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_149.png'
    Path exists (is_file)? True
  Entry 9:
    img_rel_path from JSON: 'ours/polar_chart/png/polar_chart_100examples_112.png'
    Constructed full path: 'chartllama_data/ours/polar_chart/png/polar_chart_100examples_112.png'
    Path exists (is_file)? True

Processing file: heatmap_chart_100examples_simplified_qa.json (155 entries)
  Entry 0:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_38.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_38.png'
    Path exists (is_file)? True
  Entry 1:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_27.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_27.png'
    Path exists (is_file)? True
  Entry 2:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_71.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_71.png'
    Path exists (is_file)? True
  Entry 3:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_35.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_35.png'
    Path exists (is_file)? True
  Entry 4:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_66.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_66.png'
    Path exists (is_file)? True
  Entry 5:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_25.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_25.png'
    Path exists (is_file)? True
  Entry 6:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_71.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_71.png'
    Path exists (is_file)? True
  Entry 7:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_17.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_17.png'
    Path exists (is_file)? True
  Entry 8:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_47.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_47.png'
    Path exists (is_file)? True
  Entry 9:
    img_rel_path from JSON: 'ours/heatmap_chart/png/heatmap_chart_100examples_31.png'
    Constructed full path: 'chartllama_data/ours/heatmap_chart/png/heatmap_chart_100examples_31.png'
    Path exists (is_file)? True

Processing file: box_chart_100examples_simplified_qa.json (109 entries)
  Entry 0:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_37.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_37.png'
    Path exists (is_file)? True
  Entry 1:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_56.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_56.png'
    Path exists (is_file)? True
  Entry 2:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_69.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_69.png'
    Path exists (is_file)? True
  Entry 3:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_63.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_63.png'
    Path exists (is_file)? True
  Entry 4:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_71.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_71.png'
    Path exists (is_file)? True
  Entry 5:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_26.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_26.png'
    Path exists (is_file)? True
  Entry 6:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_27.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_27.png'
    Path exists (is_file)? True
  Entry 7:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_80.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_80.png'
    Path exists (is_file)? True
  Entry 8:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_7.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_7.png'
    Path exists (is_file)? True
  Entry 9:
    img_rel_path from JSON: 'ours/box_chart/png/box_chart_100examples_37.png'
    Constructed full path: 'chartllama_data/ours/box_chart/png/box_chart_100examples_37.png'
    Path exists (is_file)? True

Processing file: scatter_chart_100examples_simplified_qa.json (89 entries)
  Entry 0:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_52.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_52.png'
    Path exists (is_file)? True
  Entry 1:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_79.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_79.png'
    Path exists (is_file)? True
  Entry 2:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_28.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_28.png'
    Path exists (is_file)? True
  Entry 3:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_21.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_21.png'
    Path exists (is_file)? True
  Entry 4:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_46.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_46.png'
    Path exists (is_file)? True
  Entry 5:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_29.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_29.png'
    Path exists (is_file)? True
  Entry 6:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_64.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_64.png'
    Path exists (is_file)? True
  Entry 7:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_31.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_31.png'
    Path exists (is_file)? True
  Entry 8:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_54.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_54.png'
    Path exists (is_file)? True
  Entry 9:
    img_rel_path from JSON: 'ours/scatter_chart/png/scatter_chart_100examples_68.png'
    Constructed full path: 'chartllama_data/ours/scatter_chart/png/scatter_chart_100examples_68.png'
    Path exists (is_file)? True

Loaded 980 raw examples. Skipped 0 invalid samples.

Raw data loaded and split.
Train samples: 882
Eval samples: 98

Sample train data point (raw):
{'id': 'ours_simplified_qa_59_0', 'question': 'What is the theme of the chart?', 'answer': 'Variation in the Consumer Price Index (CPI)', 'image_path': 'chartllama_data/ours/candlestick_chart/png/candlestick_chart_100examples_59.png'}

--- Loading Model and Processor ---
/usr/local/lib/python3.11/dist-packages/huggingface_hub/utils/_auth.py:94: UserWarning:
The secret `HF_TOKEN` does not exist in your Colab secrets.
To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.
You will be able to reuse this secret in all of your notebooks.
Please note that authentication is recommended but still optional to access public models or datasets.
  warnings.warn(
Processor loaded.
Using standard attention implementation: eager
Configuring model for Full Fine-Tuning (dtype: torch.bfloat16)...
Loading model 'HuggingFaceTB/SmolVLM-Base'...
Moving model to device: cuda
Model loaded. Device: cuda:0. Footprint: 4.49 GB
Enabling gradient checkpointing for Full Fine-Tuning.

--- Defining Formatting and Collator ---
Custom Collator defined.

--- Configuring Training Arguments ---
/usr/local/lib/python3.11/dist-packages/transformers/training_args.py:1611: FutureWarning: `evaluation_strategy` is deprecated and will be removed in version 4.46 of 🤗 Transformers. Use `eval_strategy` instead
  warnings.warn(
SFTConfig set.

--- Initializing SFTTrainer ---
SFTTrainer initialized.

--- Starting Training ---
Calling trainer.train()...
[34m[1mwandb[0m: [33mWARNING[0m The `run_name` is currently set to the same value as `TrainingArguments.output_dir`. If this was not intended, please specify a different run name by setting the `TrainingArguments.run_name` parameter.
Training finished in 63.03 minutes.

Saving final model/adapter...
Model/Adapter directory verified at: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint

Saving processor to /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor...
Processor config file verified at: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor/preprocessor_config.json

Logging metrics and saving state...
***** train metrics *****
  total_flos               = 50621808GF
  train_loss               =     0.1371
  train_runtime            = 1:03:00.74
  train_samples_per_second =        0.7
  train_steps_per_second   =      0.044
Trainer state file verified.
Metrics and state saved successfully.

--- Copying Training Output to Google Drive ---
Source (local): /content/smolvlm-chartllama-sft-refactored-full-tuned
Destination (Drive): /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned
Ensured Drive destination directory exists.
Destination directory exists, copying contents...
Using 'cp -a' command to copy...
Executing: cp -a "/content/smolvlm-chartllama-sft-refactored-full-tuned/." "/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/"
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/tokenizer_config.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/special_tokens_map.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/added_tokens.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/vocab.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/merges.txt': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/tokenizer.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/training_args.bin': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/optimizer.pt': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/scheduler.pt': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/rng_state.pth': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112/trainer_state.json': No such file or directory
cp: preserving times for '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./checkpoint-112': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./final_checkpoint/tokenizer_config.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./final_checkpoint/special_tokens_map.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./final_checkpoint/added_tokens.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./final_checkpoint/vocab.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./final_checkpoint/merges.txt': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./final_checkpoint/tokenizer.json': No such file or directory
cp: cannot create regular file '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./final_checkpoint/training_args.bin': No such file or directory
cp: preserving times for '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/./final_checkpoint': No such file or directory
Verified processor config exists in Drive destination.
--- File Copying Complete ---

Updating OUTPUT_DIR and FINAL_PROCESSOR_DIR to point to Google Drive location for subsequent evaluation cells.
New OUTPUT_DIR: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned
New FINAL_PROCESSOR_DIR: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/final_processor

--- Setting up Evaluation (Loading from Local Path) ---
Attempting to load from LOCAL paths:
  Model/Adapter: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint
  Processor: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor
Results will be saved to Drive: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/chartqa_evaluation_results.json

Loading processor from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor...
Processor loaded from local path.

Loading model/adapter from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint...
Loading fully fine-tuned model from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint
WARNING:accelerate.big_modeling:Some parameters are on the meta device because they were offloaded to the cpu.
Model loaded successfully. Device map: {'model.vision_model': 0, 'model.connector': 0, 'model.text_model.embed_tokens': 0, 'model.text_model.layers.0': 0, 'model.text_model.layers.1': 0, 'model.text_model.layers.2': 0, 'model.text_model.layers.3': 0, 'model.text_model.layers.4': 0, 'model.text_model.layers.5': 0, 'model.text_model.layers.6': 0, 'model.text_model.layers.7': 0, 'model.text_model.layers.8': 0, 'model.text_model.layers.9': 0, 'model.text_model.layers.10': 0, 'model.text_model.layers.11': 0, 'model.text_model.layers.12': 0, 'model.text_model.layers.13': 0, 'model.text_model.layers.14': 0, 'model.text_model.layers.15': 0, 'model.text_model.layers.16': 0, 'model.text_model.layers.17': 0, 'model.text_model.layers.18': 'cpu', 'model.text_model.layers.19': 'cpu', 'model.text_model.layers.20': 'cpu', 'model.text_model.layers.21': 'cpu', 'model.text_model.layers.22': 'cpu', 'model.text_model.layers.23': 'cpu', 'model.text_model.norm': 'cpu', 'model.text_model.rotary_emb': 'cpu', 'lm_head': 'cpu'}
Evaluation will use device: cuda

Loading dataset 'google/chartqa' split 'test'...
Error loading evaluation dataset 'google/chartqa': Dataset 'google/chartqa' doesn't exist on the Hub or cannot be accessed.
Traceback (most recent call last):
  File "<ipython-input-22-5ea287c8ebe1>", line 128, in <cell line: 0>
    chartqa_test_dataset = load_dataset(CHARTQA_DATASET_ID, split=EVAL_SPLIT)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/datasets/load.py", line 2062, in load_dataset
    builder_instance = load_dataset_builder(
                       ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/datasets/load.py", line 1782, in load_dataset_builder
    dataset_module = dataset_module_factory(
                     ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/datasets/load.py", line 1652, in dataset_module_factory
    raise e1 from None
  File "/usr/local/lib/python3.11/dist-packages/datasets/load.py", line 1578, in dataset_module_factory
    raise DatasetNotFoundError(f"Dataset '{path}' doesn't exist on the Hub or cannot be accessed.") from e
datasets.exceptions.DatasetNotFoundError: Dataset 'google/chartqa' doesn't exist on the Hub or cannot be accessed.

--- Evaluation Setup Complete ---

--- Setting up Evaluation (Loading from Local Path) ---
Attempting to load from LOCAL paths:
  Model/Adapter: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint
  Processor: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor
Results will be saved to Drive: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/chartqa_evaluation_results.json

Loading processor from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor...
Processor loaded from local path.

Loading model/adapter from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint...
Loading fully fine-tuned model from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint
Model loaded successfully. Device map: {'': 0}
Evaluation will use device: cuda

Loading dataset 'HuggingFaceM4/ChartQA' split 'test'...
Loaded 100 samples using islice for evaluation subset.

--- Evaluation Setup Complete ---

--- Defining Evaluation Helper Functions ---
Evaluation helper functions defined.

--- Starting Evaluation Generation on 100 samples ---
Skipping sample 0 due to missing data (Q:False, A:False, I:True)
Skipping sample 1 due to missing data (Q:False, A:False, I:True)
Skipping sample 2 due to missing data (Q:False, A:False, I:True)
Skipping sample 3 due to missing data (Q:False, A:False, I:True)
Skipping sample 4 due to missing data (Q:False, A:False, I:True)
Skipping sample 5 due to missing data (Q:False, A:False, I:True)
Skipping sample 6 due to missing data (Q:False, A:False, I:True)
Skipping sample 7 due to missing data (Q:False, A:False, I:True)
Skipping sample 8 due to missing data (Q:False, A:False, I:True)
Skipping sample 9 due to missing data (Q:False, A:False, I:True)
Skipping sample 10 due to missing data (Q:False, A:False, I:True)
Skipping sample 11 due to missing data (Q:False, A:False, I:True)
Skipping sample 12 due to missing data (Q:False, A:False, I:True)
Skipping sample 13 due to missing data (Q:False, A:False, I:True)
Skipping sample 14 due to missing data (Q:False, A:False, I:True)
Skipping sample 15 due to missing data (Q:False, A:False, I:True)
Skipping sample 16 due to missing data (Q:False, A:False, I:True)
Skipping sample 17 due to missing data (Q:False, A:False, I:True)
Skipping sample 18 due to missing data (Q:False, A:False, I:True)
Skipping sample 19 due to missing data (Q:False, A:False, I:True)
Skipping sample 20 due to missing data (Q:False, A:False, I:True)
Skipping sample 21 due to missing data (Q:False, A:False, I:True)
Skipping sample 22 due to missing data (Q:False, A:False, I:True)
Skipping sample 23 due to missing data (Q:False, A:False, I:True)
Skipping sample 24 due to missing data (Q:False, A:False, I:True)
Skipping sample 25 due to missing data (Q:False, A:False, I:True)
Skipping sample 26 due to missing data (Q:False, A:False, I:True)
Skipping sample 27 due to missing data (Q:False, A:False, I:True)
Skipping sample 28 due to missing data (Q:False, A:False, I:True)
Skipping sample 29 due to missing data (Q:False, A:False, I:True)
Skipping sample 30 due to missing data (Q:False, A:False, I:True)
Skipping sample 31 due to missing data (Q:False, A:False, I:True)
Skipping sample 32 due to missing data (Q:False, A:False, I:True)
Skipping sample 33 due to missing data (Q:False, A:False, I:True)
Skipping sample 34 due to missing data (Q:False, A:False, I:True)
Skipping sample 35 due to missing data (Q:False, A:False, I:True)
Skipping sample 36 due to missing data (Q:False, A:False, I:True)
Skipping sample 37 due to missing data (Q:False, A:False, I:True)
Skipping sample 38 due to missing data (Q:False, A:False, I:True)
Skipping sample 39 due to missing data (Q:False, A:False, I:True)
Skipping sample 40 due to missing data (Q:False, A:False, I:True)
Skipping sample 41 due to missing data (Q:False, A:False, I:True)
Skipping sample 42 due to missing data (Q:False, A:False, I:True)
Skipping sample 43 due to missing data (Q:False, A:False, I:True)
Skipping sample 44 due to missing data (Q:False, A:False, I:True)
Skipping sample 45 due to missing data (Q:False, A:False, I:True)
Skipping sample 46 due to missing data (Q:False, A:False, I:True)
Skipping sample 47 due to missing data (Q:False, A:False, I:True)
Skipping sample 48 due to missing data (Q:False, A:False, I:True)
Skipping sample 49 due to missing data (Q:False, A:False, I:True)
Skipping sample 50 due to missing data (Q:False, A:False, I:True)
Skipping sample 51 due to missing data (Q:False, A:False, I:True)
Skipping sample 52 due to missing data (Q:False, A:False, I:True)
Skipping sample 53 due to missing data (Q:False, A:False, I:True)
Skipping sample 54 due to missing data (Q:False, A:False, I:True)
Skipping sample 55 due to missing data (Q:False, A:False, I:True)
Skipping sample 56 due to missing data (Q:False, A:False, I:True)
Skipping sample 57 due to missing data (Q:False, A:False, I:True)
Skipping sample 58 due to missing data (Q:False, A:False, I:True)
Skipping sample 59 due to missing data (Q:False, A:False, I:True)
Skipping sample 60 due to missing data (Q:False, A:False, I:True)
Skipping sample 61 due to missing data (Q:False, A:False, I:True)
Skipping sample 62 due to missing data (Q:False, A:False, I:True)
Skipping sample 63 due to missing data (Q:False, A:False, I:True)
Skipping sample 64 due to missing data (Q:False, A:False, I:True)
Skipping sample 65 due to missing data (Q:False, A:False, I:True)
Skipping sample 66 due to missing data (Q:False, A:False, I:True)
Skipping sample 67 due to missing data (Q:False, A:False, I:True)
Skipping sample 68 due to missing data (Q:False, A:False, I:True)
Skipping sample 69 due to missing data (Q:False, A:False, I:True)
Skipping sample 70 due to missing data (Q:False, A:False, I:True)
Skipping sample 71 due to missing data (Q:False, A:False, I:True)
Skipping sample 72 due to missing data (Q:False, A:False, I:True)
Skipping sample 73 due to missing data (Q:False, A:False, I:True)
Skipping sample 74 due to missing data (Q:False, A:False, I:True)
Skipping sample 75 due to missing data (Q:False, A:False, I:True)
Skipping sample 76 due to missing data (Q:False, A:False, I:True)
Skipping sample 77 due to missing data (Q:False, A:False, I:True)
Skipping sample 78 due to missing data (Q:False, A:False, I:True)
Skipping sample 79 due to missing data (Q:False, A:False, I:True)
Skipping sample 80 due to missing data (Q:False, A:False, I:True)
Skipping sample 81 due to missing data (Q:False, A:False, I:True)
Skipping sample 82 due to missing data (Q:False, A:False, I:True)
Skipping sample 83 due to missing data (Q:False, A:False, I:True)
Skipping sample 84 due to missing data (Q:False, A:False, I:True)
Skipping sample 85 due to missing data (Q:False, A:False, I:True)
Skipping sample 86 due to missing data (Q:False, A:False, I:True)
Skipping sample 87 due to missing data (Q:False, A:False, I:True)
Skipping sample 88 due to missing data (Q:False, A:False, I:True)
Skipping sample 89 due to missing data (Q:False, A:False, I:True)
Skipping sample 90 due to missing data (Q:False, A:False, I:True)
Skipping sample 91 due to missing data (Q:False, A:False, I:True)
Skipping sample 92 due to missing data (Q:False, A:False, I:True)
Skipping sample 93 due to missing data (Q:False, A:False, I:True)
Skipping sample 94 due to missing data (Q:False, A:False, I:True)
Skipping sample 95 due to missing data (Q:False, A:False, I:True)
Skipping sample 96 due to missing data (Q:False, A:False, I:True)
Skipping sample 97 due to missing data (Q:False, A:False, I:True)
Skipping sample 98 due to missing data (Q:False, A:False, I:True)
Skipping sample 99 due to missing data (Q:False, A:False, I:True)

Finished generation. Processed 100 samples.

--- Defining Evaluation Helper Functions ---
Evaluation helper functions defined.

--- Copying Training Output to Google Drive ---
Source (local): /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned
Destination (Drive): /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned
Ensured Drive destination directory exists.
Destination directory exists, copying contents...
Using 'cp -a' command to copy...
Executing: cp -a "/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/." "/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/"
cp: '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/.' and '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/.' are the same file
WARNING: Processor config not found in Drive destination after copy command.
--- File Copying Complete ---

Updating OUTPUT_DIR and FINAL_PROCESSOR_DIR to point to Google Drive location for subsequent evaluation cells.
New OUTPUT_DIR: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned
New FINAL_PROCESSOR_DIR: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/final_processor

--- Setting up Evaluation (Loading from Local Path) ---
Attempting to load from LOCAL paths:
  Model/Adapter: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint
  Processor: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor
Results will be saved to Drive: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/chartqa_evaluation_results.json

Loading processor from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor...
Processor loaded from local path.

Loading model/adapter from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint...
Loading fully fine-tuned model from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint
Model loaded successfully. Device map: {'': 0}
Evaluation will use device: cuda

Loading dataset 'HuggingFaceM4/ChartQA' split 'test'...
Loaded 100 samples using islice for evaluation subset.

--- Evaluation Setup Complete ---

--- Defining Evaluation Helper Functions ---
Evaluation helper functions defined.

--- Starting Evaluation Generation on 100 samples ---

Finished generation. Processed 100 samples.

--- Calculating Evaluation Metrics ---

Sample Normalized Comparison:
  Pred 0: '7' | Ref 0: '14' -> Match: False
  Pred 1: '100' | Ref 1: '057' -> Match: False
  Pred 2: '4' | Ref 2: '3' -> Match: False
  Pred 3: 'no' | Ref 3: 'no' -> Match: True
  Pred 4: '25' | Ref 4: '23' -> Match: False

--- Evaluation Summary ---
Total samples attempted: 100
Samples with generation errors: 0
Samples used for EM calculation: 100
Exact Match (Normalized): 14.00%
-------------------------

Sample Evaluation Results (DataFrame):
   id                                           question ground_truth  \
0   0      How many food item is shown in the bar graph?       ['14']
1   1  What is the difference in value between Lamb a...     ['0.57']
2   2              How many bars are shown in the chart?        ['3']
3   3     Is the sum value of Madagascar more then Fiji?       ['No']
4   4                What's the value of the lowest bar?       ['23']

  predicted_answer
0                7
1              100
2                4
3               No
4               25

Saving evaluation results to: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/chartqa_evaluation_results.json
Results saved successfully to Google Drive.

Detailed Examples (from valid results):
--------------------
ID: 0
Question: How many food item is shown in the bar graph?
Ground Truth: ['14']
Prediction: 7
Normalized GT: '14'
Normalized Pred: '7'
--------------------
--------------------
ID: 1
Question: What is the difference in value between Lamb and Corn?
Ground Truth: ['0.57']
Prediction: 100
Normalized GT: '057'
Normalized Pred: '100'
--------------------
--------------------
ID: 2
Question: How many bars are shown in the chart?
Ground Truth: ['3']
Prediction: 4
Normalized GT: '3'
Normalized Pred: '4'
--------------------
--------------------
ID: 3
Question: Is the sum value of Madagascar more then Fiji?
Ground Truth: ['No']
Prediction: No
Normalized GT: 'no'
Normalized Pred: 'no'
--------------------
--------------------
ID: 4
Question: What's the value of the lowest bar?
Ground Truth: ['23']
Prediction: 25
Normalized GT: '23'
Normalized Pred: '25'
--------------------

--- Evaluation Script Finished ---

--- Copying Training Output to Google Drive ---
Source (local): /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned
Destination (Drive): /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned
Ensured Drive destination directory exists.
Destination directory exists, copying contents...
Using 'cp -a' command to copy...
Executing: cp -a "/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/." "/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/"
cp: '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/.' and '/content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/.' are the same file
WARNING: Processor config not found in Drive destination after copy command.
--- File Copying Complete ---

Updating OUTPUT_DIR and FINAL_PROCESSOR_DIR to point to Google Drive location for subsequent evaluation cells.
New OUTPUT_DIR: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned
New FINAL_PROCESSOR_DIR: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/final_processor

--- Setting up Evaluation (Loading from Local Path) ---
Attempting to load from LOCAL paths:
  Model/Adapter: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint
  Processor: /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor
Results will be saved to Drive: /content/drive/MyDrive/code/smolvlm-chartllama-sft-refactored-full-tuned/chartqa_evaluation_results.json

Loading processor from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_processor...
Processor loaded from local path.

Loading model/adapter from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint...
Loading fully fine-tuned model from /content/smolvlm-chartllama-sft-refactored-full-tuned/final_checkpoint
Model loaded successfully. Device map: {'': 0}
Evaluation will use device: cuda

Loading dataset 'HuggingFaceM4/ChartQA' split 'test'...
Loaded 1000 samples using islice for evaluation subset.

--- Evaluation Setup Complete ---

--- Defining Evaluation Helper Functions ---
Evaluation helper functions defined.

--- Starting Evaluation Generation on 1000 samples ---
Exception ignored in: <function _xla_gc_callback at 0x7dc8f5620d60>
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/dist-packages/jax/_src/lib/__init__.py", line 96, in _xla_gc_callback
    def _xla_gc_callback(*args):

KeyboardInterrupt:
